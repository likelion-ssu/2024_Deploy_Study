# 프론트엔드 배포와 무중단 배포

# 프론트엔드 배포

### 페이지를 ‘구성’하는 ‘방식’

페이지가 몇 개냐?

- SPA (Single Page Application)
    - 최초 렌더링에 필요한 파일을 서버에서 단 1번만 요청하여 전달
    - 최초 렌더링 이후에는 필요한 데이터만 요청하여 하나의 페이지 내부에서 부분적으로 업데이트 및 렌더링 하는 방식으로 동작
    - react vue angular
    - 장점
        - **사용자 경험 향상** : 페이지 전환이 없이 동적으로 콘텐츠를 업데이트함으로써 사용자 경험이 향상되며, 부드러운 페이지 전환이 가능하다.
        - **빠른 로딩 속도** : 초기 페이지 로딩 이후에는 서버로부터 필요한 부분만 동적으로 불러오기 때문에 효율적인 로딩 속도를 제공한다.
        - 개발 생산성 향상 : 단일 페이지의 모든 로직이 포함되어 있어 전체 애플리케이션의 상태를 쉽게 관리할 수 있으며, **코드의 재사용성이 높아진다.**
- MPA (Multi Page Application)
    - 여러 페이지로 이루어진 애플리케이션을 의미
    - 필요에 따라서 그때그때 요청하여 서버로부터 파일을 전달받음
    - 장점
        - **SEO 친화적** : MPA를 사용하여 여러 페이지를 생성할 수 있기 때문에 훨씬 더 많은 수의 키워드를 타겟팅할 수 있다.
        - **확장성 :** 다중 페이지로 원하는 만큼 페이지를 추가할 수 있다.

### 페이지를 ‘구현’하는 ‘방법’

렌더링을 어디서 하냐?

- CSR (Client Side Rendering)

![csr.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/csr.png)

1. 유저가 웹사이트에 방문하면, 브라우저가 서버에 콘텐츠를 요청한다.

2. 이에 서버는 빈 뼈대만 있는 HTML을 응답으로 보내준다.

3. 브라우저가 연결된 JavaScript 링크를 통해 서버로부터 다시 JavaScript 파일을 다운로드한다.

4. JavaScript를 통해 동적으로 페이지를 만들어 브라우저에 띄워준다.

- SSR (Server Side Rendering)

![ssr.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/ssr.png)

1. 유저가 웹사이트에 방문하면, 브라우저가 서버에 콘텐츠를 요청한다.

2. 이에 서버는 페이지에 필요한 데이터를 즉시 얻어와 모두 삽입하고, CSS까지 모두 적용해 렌더링 준비를 마친 HTML과 JavaScript코드를 브라우저에 응답으로 전달한다.

3. 브라우저에서는 JavaScript코드를 다운로드하고 HTML에 JavaScript 로직을 연결한다.

### 장단점

|  | CSR | SSR |  |
| --- | --- | --- | --- |
| 장점 | 화면 깜빡임이 없음                        초기 로딩 이후 구동 속도가 빠름TTV와 TTI 사이 간극이 없음          서버 부하 분산 | 초기 구동 속도가 빠름SEO에 유리 |  |
| 단점 | 초기 로딩 속도가 느림                 SEO에 불리 | 화면 깜빡임이 있음
 서버 부하가 있음 |  |

### 일반적으로,

SPA에서는 CSR로 렌더링하고, MPA에서는 SSR로 렌더링 한다.

SPA는 웹 애플리케이션에 필요한 정적 리소스를 한꺼번에 모두 다운로드하고, 이후 새로운 페이지 요청이 왔을 때 필요한 데이터만 전달받아서 클라이언트에서 필요한 페이지를 갱신하기 때문에 CSR로 렌더링 한다.

반면 MPA는 새로운 요청이 있을 때마다 서버에서 이미 렌더링 된 정적 리소스를 받아오기 때문에 SSR로 렌더링 한다.

다만, 이러한 특징 때문에 **SPA === CSR, MPA === SSR**이라는 오해가 생기긴 하나, 이 두 개념은 페이지의 개수와 렌더링을 어디서 하는지 등에 따라 다른 개념이라는 점을 잊지 말자.

### 내 서비스는?

### CSR

- 유저와 상호작용이 많다
- 대부분이 고객의 개인정보로 이루어진 페이지들이라 검색엔진에 노출될 필요는 없다

### SSR

- 회사 홈페이지여서 홍보나 상위노출이 필요하다
- 누구에게나 항상 같은 내용을 보여준다
- 업데이트가 빈번해 해당 페이지 데이터가 자주 바뀐다

### SSG (Static Site Generation)

1. Static-Generation : HTML을 빌드 타임에 각 페이지별로 생성하고 해당 페이지로 요청이 올 경우 이미 생성된 HTML 문서를 반환한다.
2. Server-Side-Rendering : 요청이 올 때 마다 해당하는 HTML 문서를 그때 그때 생성하여 반환한다.
- 회사 홈페이지여서 홍보나 상위노출이 필요하다
- 누구에게나 항상 같은 내용을 보여준다
- 업데이트를 거의 하지 않는다

### Universal Rendering (초기 렌더링으로는 SSR + 이후 CSR)

- 사용자에 따라 페이지 내용이 달라진다
- 빠른 interaction과 화면 깜빡임이 없어야 한다
- SEO를 포기할 수 없어 상위노출이 되면 좋겠다

## 프론트엔드만! 배포

빌드된 파일이 웹을 통해 제공이 되려면 정적 파일을 제공할 웹서버가 필요하다.

동적 웹사이트나 API서버를 제공하려면 클라우딩 컴퓨팅 서비스가 필요하니,

**웹 호스팅 서비스**를 사용해서 정적 파일만 제공할 수 있게 해봅시다.

vercel netlify github heroku

하루에 빌드를 여러번 할 거 아니니까 vercel 배포를 해보자.

빌드 세팅은 프레임워크마다 다 다름. 문서보고 하면 됩니다.

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/Untitled.png)

벌레잡기 게임을 두더지잡기로 변경할려고 한다.

두더지잡기 게임을 같은 도메인에 올리니까 해당 도메인은 다운되었다.

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/Untitled%201.png)

# CI/CD와 무중단 배포

**CI가 없다면?**

- 여러 사람이 한 곳에서 merge
- merge 후 에러가 발생했다면?
- 어느 곳에서 문제가 생긴거지?????
- 누가 죄인인가?

**그래서 CI 개념이 최초 등장**

- 코드를 수정, 생성할 때마다 자동으로 병합하자. → 문제가 생기면 그 분기에 그 사람이 고치자.

**CI 과정**

개발자 → CI 툴 (젠킨스, github actions, gitlab 등이 있다. 비교 참고자료 : /[](https://www.notion.so/a77d6683288b4084b573a68e05b8c892?pvs=21) )

→ 빌드 , 테스트 → **문제가 생기면? → 개발자**

**마틴 파울러 아저씨**

https://youtu.be/4E1BHTvhB7Y?si=xWC7nrNFZibeT2LI

https://youtu.be/aoMfbgF2D_4?si=z2hPzVw7ZIYDaQHr

**CI 의 4가지 규칙**

1. 모든 소스코드로 돌아갈 수 있어야 한다. 현재의 소스에 접근할 수 있는 단일 지점을 유지해야 한다.
2. 빌드 프로세스 자동화
3. 테스팅 자동화
4. 현재 실행 파일은 완전한 실행 파일이어야 한다.

**CD가 없다면?**

배포 스크립트를 수동으로 서버 여러 대에 실행해야 함

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/Untitled%202.png)

### **CI / CD 과정**

개발자 → CI 툴 (젠킨스,github actions,gitlab 등이 있다. 비교 참고자료 : /[](https://www.notion.so/a77d6683288b4084b573a68e05b8c892?pvs=21) ) 

→ 빌드 , 테스트 → 문제가 생기면? → 개발자

**문제가 없다면? → 서버에 자동으로 배포**

### **무중단 배포**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/Untitled%203.png)

**기존 버전과 새로운 버전 사이의 다운 타임**을 삭제!!

### **로드 밸런싱**

![loadbalancing.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/loadbalancing.png)

로드 밸런싱이란 말 그대로 **서버가 처리해야 할 업무 혹은 요청(Load)을 여러 대의 서버로 나누어(Balancing) 처리하는 것**을 의미한다. 

**한 대의 서버로 부하가 집중되지 않도록 트래픽을 관리**해 각각의 서버가 최적의 퍼포먼스를 보일 수 있도록 하는 것이 목적이다.

서비스의 규모가 커지고, 이용자 수가 늘어나게 되면 기존의 서버만으로는 원활한 서비스 동작이 불가능하게 되고, 이에 대처할 수 있는 방법은 크게 두 가지로 나뉜다.

- 기존의 서버 성능을 확장하는 Scale-up 방식
- 기존의 서버와 동일하거나 낮은 성능의 서버를 증설하는 **Scale-out 방식**

이때 Scale-out 방식을 통해 증가한 트래픽에 대처하기로 했다면, 여러 대의 서버로 트래픽을 균등하게 분산해주는 로드 밸런싱이 반드시 필요하다.

### **무중단 배포 구현 방법**

- V1 → 구버전
- V2 → 신버전
1. **롤링 방식**

![rolling2.gif](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/rolling2.gif)

V1이 실행되고 있는 서버 하나를 로드밸런서에서 떼어낸다. 이렇게 되면, 해당 서버에는 트래픽이 도달하지 않게 된다. 이 상태에서 해당 서버의 어플리케이션을 V2로 교체한다. 이 과정을 반복해서 모든 서버를 새로운 버전으로 교체한다.

- **장점**
    - k8s, elastic beanstalk과 같은 **많은 오케스트레이션 도구에서 지원**
    - **많은 서버 자원을 확보하지 않아도 무중단 배포**가 가능
- **단점**
    - **배포 도중 서비스 중인 인스턴스의 수가 줄어들게 되어 각각의 서버가 부담하는 트래픽의 양이 늘어날** 수 있다.
    - 구버전과 신버전의 어플리케이션이 동시에 서비스되기 때문에 **호환성 문제**가 발생
1. **BLUE / GREEN 방식**

![bluegreen.gif](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/bluegreen.gif)

트래픽을 한번에 구버전에서 신버전으로 옮기는 방법이다. Blue/Green 배포 전략에서는 **현재 운영중인 서비스의 환경을 Blue라고 부르고, 새롭게 배포할 환경을 Green**이라고 부른다.

- **장점**
    - 롤링 배포와 달리 한번에 트래픽을 모두 새로운 버전으로 옮기기 때문에 **호환성 문제가 발생하지 않는다**.
- **단점**
    - 실제 운영에 필요한 서버 리소스 대비 **2배의 리소스**를 확보해야한다.

1. **까나리 방식**

![canary.gif](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%AB%E1%84%90%E1%85%B3%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%83%E1%85%B3%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%AE%E1%84%8C%E1%85%AE%E1%86%BC%E1%84%83%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9%20089cde4b8f64427fa28ae434925a3969/canary.gif)

점진적으로 구버전에 대한 트래픽을 신버전으로 옮기는 것은 롤링 배포 방식과 비슷하다. 다만 카나리 배포의 핵심은 새로운 버전에 대한 **오류를 조기에 감지**하는 것이다.

소수 인원에 대해서만 트래픽을 새로운 버전에 옮겨둔 상태에서 서비스를 운영한다. 새로운 버전에 이상이 없다고 판단하였을 경우에 모든 트래픽을 신규 버전으로 옮긴다. 이때, 트래픽을 새로운 버전으로 옮기는 기준은 정해진 규칙(특정 유저 등) 혹은 랜덤이다.

> 카나리 배포의 이름은 예전 광부들이 가스에 예민한 카나리아 새를 활용하여 가스 누출을 감지했다는 이야기에서 유래되었다.
> 

- **장점**
    - 새로운 버전으로 인한 위험을 최소화
    - A/B 테스트
- **단점**
    - 호환성 문제

CI 툴 비교

|  | Jenkins | Github Actions | GitLab |
| --- | --- | --- | --- |
| 서버 | 별도의 서버 필요. | 클라우드로 동작. 별도의 설치 X. | 클라우드 or 설치형 두 개. |
| 비용 | 툴 자체 라이선스는 무료.하지만 젠킨스 서버를 유지하는 비용 소모. | Private Repository는 한달에 500MB,2,000분 까지 무료로 사용.초과되는 Minutes 마다 추가 비용 지불. | 무료로 400분의 CI/CD 사용 지원. 추가 이용하기 위해선 유료 라이선스 必.  |
| 동기 / 비동기 | 젠킨스 파이프라인을 통한 비동기 처리 가능. | 비동기 CI / CD 가능. | 비동기 처리 가능. |
| 사용성 | GUI라 친근하지만 초기 설정이 까다로움. | Github에 친숙한 개발자에게는 더 좋음.초기 설정이 쉬움. | Github에 친숙한 개발자에게는 더 좋음.
초기 설정이 쉬움. |
| 문서화 | 전 세계 많은 사람들이 이용하기 떄문에 문서가 다양. | Jenkins에 비해 문서가 적음. | Jenkins에 비해 문서가 적음. |
| REST API | REST API 지원. | Github API 지원. | REST API 지원. |
| 공유성 | 공유할 수 없음. | Github 마켓 플레이스에서 Workflow 공유 가능. | 공유할 수 없음. |
| 장점 | 자동화 테스트 수행.정적 코드 분석에 의한 코딩 규약 준수여부 체크.프로젝트 표준 컴파일 환경에서의 컴파일 오류 검출.프로파일링 툴을 이용한 소스 변경에 따른 성능 변화 감시.빌드 파이프라인의 구성을 간단히 할 수 있음.각종 배치 작업의 간략화. | Github 마켓 플레이스를 통한 Workflow 복제가 용이.Github에 친숙한 개발자들에게 접근성이 좋음.실행 및 디버깅이 쉬움.Github API를 통해 쉽게 액세스 가능.서버를 직접 관리하지 않아도 되며, Github 페이지에서 모든 과정을 확인 가능. | Auto-Scaling CI Runner를 제공.
다른 Tool에 비해 UI가 깔끔. 모바일 Web, App으로도 사용 가능.
오픈 소스 그룹이 활발해서 주기적인 업데이트가 있음.
파이프라인 내의 모든 Job들이 독립적.  |
| 단점 | 프로젝트의 규모가 작은 경우, 설정하는데 리소스 낭비가 발생.호스팅을 직접해야하기 때문에 서버 운영 및 관리 비용 발생.플러그인을 최신 상태로 유지해야하며 업데이트 하지 않을 경우 장애가 발생 할 수 있음. | Public Repository에서는 무료로 사용 가능하지만, Private Repository에서는 요금이 발생.참고할만한 문서가 비교적 부족.Workflow에서 단일 작업만 다시 실행할 수 없음. | Push, Pull 수행 속도가 Github보다 느림.
모든 job에 대해 artifact를 정의 및 업로드/다운로드 해야함. |
| 총평 | 새로 생긴 CI툴에 비해 초기 설정이 어렵다는 단점이 있지만, 많은 플러그인과 비용이 무료라는 이점들이 있기에 대규모 프로젝트를 운영함에 있어서 적합하다. | 최신 CI 툴이며 Github에서 사용해 친숙하며, 별도의 설치 없이 클라우드에서 관리를 하기 때문에 편리하다는 장점이 있지만, IIS 서버를기반으로 한 CD가 불가능 하다는 단점이 있다. | Github에서 기존에 제공하던 형상관리 기능과 더불어
CI 기능까지 제공하지만, GitLab과 관련된 참고문서가 적고 기존 Repository를 옮겨야 한다는 단점이 있다. |
| 요금정책 | 별도의 서버 유지 비용을 제외하면 무료. | 1. Included storage and minutesGitHub Free                  500 MB 2,000분(월)GitHub Pro                   1 GB 3,000분(월)GitHub Free for organizations500 MB 2,000분(월)GitHub Team                   2 GB 3,000분(월)GitHub Enterprise Cloud50 GB 50,000분(월)2. Minute multipliersLinux 1macOS 10 (ex. Linux가 1분 이용 = MacOs 10분 이용)Windows 23. Per-minute ratesLinux  $0.008macOS  $0.08Windows  $0.016 | Free : 400분의 CI/CD 지원
Premium : 10,000분의 CI/CD 지원 및 부가 기능 지원
 한 달에 한 사용자 당 19$
Ultimate : 50,000분의 CI/CD 지원 및 부가 기능 지원
 한 달에 한 사용자 당 99$ |